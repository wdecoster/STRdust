# Configuration for cargo-deny
# https://embark-studios.github.io/cargo-deny/

[licenses]
# Allow specific licenses
allow = [
    "MIT",
    "Apache-2.0", 
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause", 
    "ISC",
    "Unicode-3.0",  # Unicode License v3 - used by ICU/Unicode crates
    "Zlib",         # zlib License - used by foldhash crate
    "MPL-2.0",      # Mozilla Public License 2.0 - used by option-ext crate
]

# Confidence threshold for detecting licenses
confidence-threshold = 0.8

[bans]
# Lint level for when multiple versions of the same crate are detected
multiple-versions = "warn"
# Lint level for when a crate version requirement is `*`
wildcards = "warn"

# Skip certain crates for multiple version checks
skip = [
    # Common crates that often have multiple versions due to ecosystem splits
    { name = "rand", reason = "Machine learning crates require different rand versions" },
    { name = "rand_core", reason = "Part of rand ecosystem version splits" },
    { name = "rand_chacha", reason = "Part of rand ecosystem version splits" },
    { name = "getrandom", reason = "Random number generation, version compatibility" },
    { name = "hashbrown", reason = "HashMap implementation versions" },
    { name = "itertools", reason = "Iterator utilities, ecosystem compatibility" },
    { name = "derive-new", reason = "Different versions in bio ecosystem (0.6 vs 0.7)" },
    { name = "thiserror", reason = "Error handling, v1 vs v2 ecosystem split" },
    { name = "thiserror-impl", reason = "Part of thiserror ecosystem" },
    { name = "windows-link", reason = "Windows platform different versions (0.1 vs 0.2)" },
    { name = "windows-result", reason = "Windows platform different versions (0.3 vs 0.4)" },
    { name = "windows-strings", reason = "Windows platform different versions (0.4 vs 0.5)" },
    # Windows platform support
    { name = "windows-sys", reason = "Windows API versions for different features" },
    { name = "windows-targets", reason = "Windows target specifications" },
    { name = "windows_aarch64_gnullvm", reason = "Windows ARM64 target support" },
    { name = "windows_aarch64_msvc", reason = "Windows ARM64 MSVC target" },
    { name = "windows_i686_gnu", reason = "Windows 32-bit GNU target" },
    { name = "windows_i686_gnullvm", reason = "Windows 32-bit GNU LLVM target" },
    { name = "windows_i686_msvc", reason = "Windows 32-bit MSVC target" },
    { name = "windows_x86_64_gnu", reason = "Windows 64-bit GNU target" },
    { name = "windows_x86_64_gnullvm", reason = "Windows 64-bit GNU LLVM target" },
    { name = "windows_x86_64_msvc", reason = "Windows 64-bit MSVC target" },
]

[advisories]
# The path where the advisory database is cloned/fetched into
db-path = "~/.cargo/advisory-db"
# The url(s) of the advisory databases to use
db-urls = ["https://github.com/rustsec/advisory-db"]

# Handle known unmaintained crates that are still widely used
ignore = [
    # Bio crate dependencies that are unmaintained but still functional
    "RUSTSEC-2025-0058",  # custom_derive - widely used in bio ecosystem
    "RUSTSEC-2025-0057",  # fxhash - used by bio, has replacement but not critical
    "RUSTSEC-2024-0436",  # paste - used by nalgebra/simba and minimap2-sys, archived but stable
]

[sources]
# Lint level for what to happen when a crate from a git repository is encountered
unknown-git = "warn"
# Lint level for what to happen when a crate from a registry that is not in the allow list is encountered
unknown-registry = "warn"

allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []
